# 拉取docker hub 上的google镜像

docker pull mirrorgooglecontainers/kube-apiserver-amd64:v1.11.7 &&
docker pull mirrorgooglecontainers/kube-controller-manager-amd64:v1.11.7 &&
docker pull mirrorgooglecontainers/kube-scheduler-amd64:v1.11.7 &&
docker pull mirrorgooglecontainers/kube-proxy-amd64:v1.11.7 &&
docker pull mirrorgooglecontainers/pause:3.1 &&
docker pull mirrorgooglecontainers/etcd-amd64:3.2.18 &&
docker pull coredns/coredns:1.1.3

# 更改镜像标签，还原google镜像
docker tag docker.io/mirrorgooglecontainers/kube-proxy-amd64:v1.11.7 k8s.gcr.io/kube-proxy-amd64:v1.11.7 &&
docker tag docker.io/mirrorgooglecontainers/kube-scheduler-amd64:v1.11.7 k8s.gcr.io/kube-scheduler-amd64:v1.11.7 &&
docker tag docker.io/mirrorgooglecontainers/kube-apiserver-amd64:v1.11.7 k8s.gcr.io/kube-apiserver-amd64:v1.11.7 &&
docker tag docker.io/mirrorgooglecontainers/kube-controller-manager-amd64:v1.11.7 k8s.gcr.io/kube-controller-manager-amd64:v1.11.7 &&
docker tag docker.io/mirrorgooglecontainers/etcd-amd64:3.2.18  k8s.gcr.io/etcd-amd64:3.2.18 &&
docker tag docker.io/mirrorgooglecontainers/pause:3.1  k8s.gcr.io/pause:3.1 &&
docker tag docker.io/coredns/coredns:1.1.3  k8s.gcr.io/coredns:1.1.3


# master部署成功
kubeadm join 192.168.11.133:6443 --token aru0ap.1w4q2gsjtymx88eu --discovery-token-ca-cert-hash sha256:4f4127d4be421c17715594a0caebd74141c4ac53161ab72c9bcda73479a21125

# 配置安全策略
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
